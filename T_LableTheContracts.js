const fs = require("fs")
const { exec } = require("child-process")

// 读取json文件
const data = fs.readFileSync("./contract_data/typecodeData.json", "utf-8")
const contract = JSON.parse(data)

// 运行 Docker 命令
exec(
    //`docker run -v ${contract.path}:/contract trailofbits/slither /contract/${contract.filename}`,
    `docker run -it --rm -v D:/Code/JS-Solidity/Graduation_Project/contract_data:/src trailofbits/slither /src/${typecodeData.json}`,

    (error, stdout, stderr) => {
        if (error) {
            console.error(`执行出错: ${error}`)
            return
        }
        // 处理检测结果
        if (stdout.includes("reentrance")) {
            // 修改 JSON 数据
            contract.array.reentrance = 1
            // 写回 JSON 文件
            fs.writeFileSync("contract.json", JSON.stringify(contract))
        }
    }
)

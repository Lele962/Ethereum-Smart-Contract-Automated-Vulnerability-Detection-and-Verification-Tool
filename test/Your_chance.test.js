// 导入相关库
const { expect } = require("chai")
const { ethers } = require("hardhat")

// 编写测试用例
describe("YOUR_CHANCE contract", function () {
    let contract

    beforeEach(async function () {
        const Contract = await ethers.getContractFactory("YOUR_CHANCE")
        contract = await Contract.deploy()
        await contract.deployed()
    })

    it("should overflow when calling set_game with large value", async function () {
        // 构建一个交易，向智能合约发送一个大于 uint256 的值
        const largeValue = ethers.constants.MaxUint256 + 1
        await expect(
            contract.set_game("test question", "test response", {
                value: largeValue,
            })
        ).to.be.revertedWith("revert")
    })
})
// 这个错误表明你尝试发送的以太币数量超过了 Solidity 中 uint256 的最大值，即 2^256-1，因此交易无法被执行。
// 这与之前的 InvalidInputError 错误不同，InvalidInputError 表示发送交易的账户的以太币余额不足，而这个错误则表示你尝试发送的数量太大，超出了 Solidity 可以表示的范围。
// 因此，这个错误进一步证实了智能合约存在整数溢出漏洞。
// 1) YOUR_CHANCE contract
// should overflow when calling set_game with large value:
// Error: value cannot exceed MAX_INTEGER (2^256-1), given 1157920892373161954235709850086879078532699846656405640394575840079131296399351 (tx type=2 hash=not available (unsigned) nonce=1 value=1157920892373161954235709850086879078532699846656405640394575840079131296399351 signed=false hf=error maxFeePerGas=undefined maxPriorityFeePerGas=undefined)
// at FeeMarketEIP1559Transaction._validateCannotExceedMaxInteger (node_modules\@nomicfoundation\ethereumjs-tx\src\baseTransaction.ts:442:21)
// at new BaseTransaction (node_modules\@nomicfoundation\ethereumjs-tx\src\baseTransaction.ts:112:10)
// at new FeeMarketEIP1559Transaction (node_modules\@nomicfoundation\ethereumjs-tx\src\eip1559Transaction.ts:149:5)
// at Function.fromTxData (node_modules\@nomicfoundation\ethereumjs-tx\src\eip1559Transaction.ts:65:12)
// at HardhatNode.getSignedTransaction (node_modules\hardhat\src\internal\hardhat-network\provider\node.ts:454:42)
// at EthModule._sendTransactionAction (node_modules\hardhat\src\internal\hardhat-network\provider\modules\eth.ts:1036:33)
// at processTicksAndRejections (node:internal/process/task_queues:95:5)
// at runNextTicks (node:internal/process/task_queues:64:3)
// at listOnTimeout (node:internal/timers:538:9)
// at processTimers (node:internal/timers:512:7)

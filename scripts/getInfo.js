require("dotenv").config()
const { ethers } = require("hardhat")
require("@nomicfoundation/hardhat-toolbox")
require("@nomiclabs/hardhat-etherscan")
require("hardhat-gas-reporter")
require("solidity-coverage")
require("hardhat-deploy")

async function main() {
    const provider = new ethers.providers.JsonRpcProvider()

    // 获取 Goerli 网络上的最新区块号
    const blockNumber = await provider.getBlockNumber()

    // 指定需要获取的区块号
    const targetBlockNumber = 10

    // 获取指定区块上的所有交易
    const block = await provider.getBlockWithTransactions(targetBlockNumber)

    // 遍历所有交易
    for (const tx of block.transactions) {
        // 判断交易是否为智能合约的创建交易
        if (tx.to === null) {
            // 获取智能合约的账户地址和字节码
            const contractAddress = ethers.utils.getContractAddress({
                from: tx.from,
                nonce: tx.nonce,
            })
            const contractCode = await provider.getCode(contractAddress)

            console.log(`Contract address: ${contractAddress}`)
            console.log(`Contract code: ${contractCode}`)
        }
    }
}

main()
    .then(() => process.exit(0))
    .catch((error) => {
        console.error(error)
        process.exit(1)
    })

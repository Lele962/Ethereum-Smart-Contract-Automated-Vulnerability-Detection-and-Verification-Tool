require("dotenv").config
const ETH_URL_API = process.env.ETH_URL_API
const Web3 = require("web3")
// 创建web3实例
const web3 = new Web3(new Web3.providers.HttpProvider(ETH_URL_API))
// 获取指定区块内所有智能合约的账户地址、字节码和以太等链上数据
web3.eth.getBlockNumber().then((blockNumber) => {
    for (let i = 0; i < blockNumber; i++) {
        web3.eth.getBlock(i).then((block) => {
            if (block.transactions.length > 0) {
                block.transactions.forEach((tx) => {
                    web3.eth.getTransactionReceipt(tx).then((receipt) => {
                        if (receipt.contractAddress) {
                            console.log(
                                `Contract Address: ${receipt.contractAddress}`
                            )
                            console.log(
                                `Contract Code: ${web3.eth.getCode(
                                    receipt.contractAddress
                                )}`
                            )
                            console.log(
                                `Contract Ether Balance: ${web3.eth.getBalance(
                                    receipt.contractAddress
                                )}`
                            )
                        }
                    })
                })
            }
        })
    }
})
